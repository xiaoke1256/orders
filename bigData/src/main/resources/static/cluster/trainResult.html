<!DOCTYPE html>
<html lang="en" style="height:100%">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>orders-bigdata welcome!</title>
    <base href="../">
    <script type="text/javascript" src="js/jquery.min.js" ></script>
    <script type="text/javascript" src="js/date_format.js" ></script>
    <script type="text/javascript" src="js/jq_page.js" ></script>
    <script type="text/javascript" src="js/echarts.min.js" ></script>
    <link rel="stylesheet" type="text/css" title="default" href="css/style.css" >
    <script type="text/javascript">
      $(function(){
        //从地址栏获取参数
        var urlParams = new URLSearchParams(window.location.search);
        var modelPath = urlParams.get('modelPath');
        var productCode = urlParams.get('productCode');
        var productName = urlParams.get('productName');
        //alert("modelPath:"+modelPath);
        var reqData = {
          modelPath:modelPath,
          condition:{
            productCode:productCode,
            productName:productName
          }
        };

        //调用预测
        $.ajax({
			url:"product/cluster/predict",
			type:"POST",
			dataType:"json",
			data:JSON.stringify(reqData),
			contentType: "application/json;charset=utf-8",
			headers: {'Content-Type': 'application/json;charset=UTF-8'},
			success: function (ret) {
			  //分了多少个类
			  var clusters = [];
              for(var i in ret){
                var sample = ret[i].sample;
                var label = ret[i].label;
                var cluster = clusters[label];
                if(!cluster){
                  cluster = [];
                  clusters[label] = cluster;
                }
                var row = [sample.productPrice/1000,sample.orderCount,sample.productName,sample.productCode]
                cluster.push(row);
              }
              showChart(clusters)

			},
			error:function(err){
				alert("预测异常："+err.status);
			}
	    });
      });

      var COLORS = ['#80FFA5',
          '#00DDFF',
          '#37A2FF',
          '#FF0087',
          '#FFBF00',
          '#37A2DA',
          '#e06343',
          '#37a354',
          '#b55dba',
          '#b5bd48',
          '#8378EA',
          '#96BFFF'
      ];

      function showChart(clusters){
        var series = [];
        for(var i in clusters){
          var cluster = clusters[i];
          series.push({
              name: 'Cluster'+i,
              symbolSize: 20,
              data: clusters[i],
              type: 'scatter',
              itemStyle: {
                color: COLORS[i%COLORS.length],
              }
            });
        }
        var chartDom = document.getElementById('chart');
        var myChart = echarts.init(chartDom);
        var option = {
          legend: {
            data: ['Female', 'Male'],
            left: 'center',
            bottom: 10
          },
          tooltip: {
            position: 'top',
            formatter: function(param){
              return  '<b>'+param.data[2]+'</b><br>￥'+param.data[0]+','+param.data[1]+"单 ";
            }
          },
          xAxis: {},
          yAxis: {},
          series: series
        };

        option && myChart.setOption(option);
      }
    </script>
  </head>
  <body style="height:100%">
    <div style="height:85%">
      <div id="chart" style="height:85%" ></div>
    </div>
    <button>保存模型</button>
  </body>
</html>